{
  "active_model": None,
  "comparison_views": {
      "view_1": {
          "target": "Motionview",
          "tests": ["Adams"],
          "sim": "CS100"
      }
  },
  "active_view": "view_1"
}

dbc.Modal(
    [
        dbc.ModalHeader("Create Comparison"),
        dbc.ModalBody(
            [
                dbc.Label("Target Model"),
                dbc.Select(id="new-cmp-target"),

                dbc.Label("Test Models", className="mt-2"),
                dbc.Select(id="new-cmp-tests", multiple=True),

                dbc.Label("Simulation", className="mt-2"),
                dbc.Select(id="new-cmp-sim"),
            ]
        ),
        dbc.ModalFooter(
            [
                dbc.Button("Cancel", id="new-cmp-cancel", color="secondary"),
                dbc.Button("Create", id="new-cmp-create", color="primary"),
            ]
        ),
    ],
    id="new-cmp-modal",
    is_open=False,
)

from dash import Input, Output, State, callback, ctx
import uuid

@callback(
    Output("new-cmp-modal", "is_open"),
    Input("btn-new-comparison", "n_clicks"),
    Input("new-cmp-cancel", "n_clicks"),
    Input("new-cmp-create", "n_clicks"),
    State("new-cmp-modal", "is_open"),
    prevent_initial_call=True,
)
def toggle_new_cmp(btn, cancel, create, is_open):
    return not is_open

@callback(
    Output("new-cmp-target", "options"),
    Output("new-cmp-tests", "options"),
    Output("new-cmp-sim", "options"),
    Input("btn-new-comparison", "n_clicks"),
    prevent_initial_call=True,
)
def populate_new_cmp(_):
    model_options = [{"label": m, "value": m} for m in MODELS.keys()]

    # Get sims from first model (assuming consistent)
    if MODELS:
        first_model = next(iter(MODELS.values()))
        sim_options = [{"label": s, "value": s} for s in first_model.sims.keys()]
    else:
        sim_options = []

    return model_options, model_options, sim_options

@callback(
    Output("app-state", "data"),
    Output("url", "pathname"),
    Input("new-cmp-create", "n_clicks"),
    State("new-cmp-target", "value"),
    State("new-cmp-tests", "value"),
    State("new-cmp-sim", "value"),
    State("app-state", "data"),
    prevent_initial_call=True,
)
def create_comparison(n, target, tests, sim, state):

    if not target or not tests or not sim:
        return state, None

    view_id = f"view_{uuid.uuid4().hex[:6]}"

    state["comparison_views"][view_id] = {
        "target": target,
        "tests": tests,
        "sim": sim,
    }

    state["active_view"] = view_id

    return state, f"/comparison/{view_id}"

@callback(
    Output("comparison-view-list", "children"),
    Input("app-state", "data"),
)
def update_sidebar_views(state):

    views = state.get("comparison_views", {})

    items = []

    for view_id in views.keys():
        items.append(
            dbc.ListGroupItem(
                view_id,
                href=f"/comparison/{view_id}",
                action=True,
            )
        )

    return items


